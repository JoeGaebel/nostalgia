#= require applications/edit/sphere_view

class SphereSelectView
  constructor: (options = {}) ->
    @app = options.app
    @portalView = options.portalView
    $(document).ready(@onDocumentReady)

  onDocumentReady: =>
    @renderSpheres()
    @createUIHash()
    @bindHandlers()

  createUIHash: ->
    @ui =
      $sphereLink: $('.sphere-link')

  bindHandlers: ->
    @ui.$sphereLink.click(@onSphereLinkClicked)

  renderSpheres: ->
    $addSphereLink = $('.add-sphere-link')
    for sphere in window.memory.spheres
      view = new SphereView(sphere)
      html = $(view.render())
      html.insertBefore($addSphereLink)


  onSphereLinkClicked: (e) =>
    id = parseInt(e.currentTarget.id)
    associatedSphere = _.findWhere(window.memory.spheres, { id })
    @app.setNextSphere(associatedSphere)

    @app.resetPageState()


window.SphereSelectView = SphereSelectView
