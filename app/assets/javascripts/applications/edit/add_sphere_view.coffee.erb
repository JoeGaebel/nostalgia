class AddSphereView
  constructor: (options = {}) ->
    @app = options.app
    $(document).ready(@onDocumentReady)

  onDocumentReady: =>
    @createUIHash()
    @bindHandlers()

  createUIHash: ->
    @ui =
      $addSphereLink: $('.add-sphere-link')
      $submit: $('#upload-submit')
      $cancel: $('#upload-cancel')
      $caption: $('.sphere-caption')
      $file: $('.sphere-file')

  bindHandlers: ->
    @ui.$addSphereLink.click(@onAddSphereLinkClick)
    @ui.$cancel.click(@resetPageState)
    @ui.$submit.click(@onSubmitClick)

  onAddSphereLinkClick: (event) =>
    @ui.$addSphereLink.addClass('expanded')

  resetPageState: =>
    @ui.$addSphereLink.removeClass('expanded')
    event.stopPropagation()

  onSubmitClick: =>
    formData = new FormData()
    formData.append('sphere[panorama]', @ui.$file[0].files[0]);
    formData.append('sphere[caption]', @ui.$caption.val());
    formData.append('memory_id', window.memory.id);

    $.ajax
      url: '/spheres',
      data: formData,
      cache: false,
      contentType: false,
      processData: false,
      type: 'POST'
      success: @onCreateSphereSuccess
      error: @app.onAjaxError


  onCreateSphereSuccess: =>
    console.log("yayy")


window.AddSphereView = AddSphereView
